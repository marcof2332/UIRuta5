
<div class="example-container">
  <h2>Ingreso de Pedidos</h2>

    <mat-horizontal-stepper
    [linear]="true"
    #stepper
    [orientation]="(stepperOrientation | async)!">
      <!-- Step 1 -->
      <mat-step>
        <form id="orderForm" [formGroup]="myForm">
          <ng-template matStepLabel>Paso 1</ng-template>
          <mat-radio-group class="sh-radiogroup" (change)="onRadioChange($event)">
            <mat-radio-button [checked]="true" value="retiroDomicilio">Retiro a Domicilio</mat-radio-button>
            <mat-radio-button value="envioVentanilla">Envío por Ventanilla</mat-radio-button>
          </mat-radio-group>
          <div>
            <button mat-button matStepperNext >Siguiente</button>
          </div>
        </form>
      </mat-step>

      <!-- Step 2 - Retiro a Domicilio -->
      <mat-step>
        <ng-template matStepLabel>Paso 2</ng-template>

        <div class="example-container">

        <form class="orderForm" *ngIf=" this.type === 'retiroDomicilio'" [formGroup]="getFormGroup()">
            <!-- Campos para Retiro a Domicilio -->

            <table>
              <tr>
              <td>
                <mat-form-field class="fwhid">
                  <mat-label>Inicio disponibilidad (Opcional)</mat-label>
                  <input matInput type="time" formControlName="StartTime">
                </mat-form-field>
              </td>
              <td>
                <mat-form-field class="fwhid">
                  <mat-label>Final disponibilidad (Opcional)</mat-label>
                  <input matInput type="time" formControlName="EndTime">
                </mat-form-field>
              </td>
              </tr></table>
              <fieldset class="zone-container">
                <legend class="lgn">Zona de Retiro</legend>
              <table><tr>
                <td>
                  <mat-form-field class="fwhid">
                    <mat-label>Departamento</mat-label>
                    <mat-select #stateselect
                                (valueChange)="loadCities($event)"
                                [disabled]="!departamentoSelectEnabled">
                        <mat-option *ngFor="let item of statesValueList; let i = index" [value]="item" >
                          {{ statesLabelList[i] }}
                        </mat-option>
                    </mat-select>
                  </mat-form-field>
                </td>
                <td>
                  <mat-form-field class="fwhid">
                    <mat-label>Ciudad</mat-label>
                    <mat-select #cities
                                (valueChange)="loadZones($event)"
                                [disabled]="!ciudadSelectEnabled">
                        <mat-option *ngFor="let item of citiesValueList; let i = index" [value]="item">
                        {{ citiesLabelList[i] }}
                      </mat-option>
                    </mat-select>
                  </mat-form-field>
                </td>
                <td>
                  <mat-form-field>
                    <mat-label>Zona</mat-label>
                    <mat-select #zone
                                formControlName="PickupZone"
                                (valueChange)="onSelectChange($event, 0)">
                      <mat-option *ngFor="let item of CityZones; let i = index" [value]="item.IdZone">
                        {{ item.ZoneName }}
                      </mat-option>
                    </mat-select>
                  </mat-form-field>
                </td>
              </tr></table>
            </fieldset>
            <!-- Mapa -->
            <ng-container *ngIf="retirementZoneMapEnabled" >
              <google-map   class="map-s"
                            #map
                            [center]="retirementZoneCenter"
                            [zoom]="retirementZoneZoom">

              <map-marker [position]="retirementZoneMarkerPosition"></map-marker>

              <map-polygon [paths]="retirementZonePolygonPoints"
                           [options]="retirementZonePolygonOptions"
                           (polygonClick)="addMarker($event, 0)"
                           ></map-polygon>
              </google-map>
            </ng-container>

            <table><tr>
              <td>
              <!-- Direccion -->
              <mat-form-field
                  class="fwhid"
                  [ngStyle]="{ 'padding-bottom.px': !isValidField('PickupAddressRetirementArea') ? 0 : 40 }">
                <input
                    type="text"
                    matInput
                    placeholder="Dirección"
                    formControlName="PickupAddressRetirementArea">
                <mat-error *ngIf="isValidField('PickupAddressRetirementArea')">
                  {{getErrorMessage('PickupAddress')}}
                </mat-error>
              </mat-form-field>
            </td>
            <td>
              <mat-form-field class="fwhid m">
                <mat-label>Comentarios</mat-label>
                <textarea matInput formControlName="Note"></textarea>
              </mat-form-field>
            </td>
          </tr>
          <tr>
          <td>
            <mat-form-field class="fwhid" [ngStyle]="{ 'padding-bottom.px': !isValidField('Sender') ? 0 : 40 }">
              <mat-label>Remitente</mat-label>
              <mat-select formControlName="Sender" placeholder="Selecciona un remitente">
                <mat-option *ngFor="let cliente of customers" [value]="cliente.DocRut">
                  {{ cliente.CustomerName }} {{ cliente.CLastName }}
                </mat-option>
              </mat-select>
              <mat-error *ngIf="isValidField('Sender')">
                {{ getErrorMessage('Sender') }}
              </mat-error>
            </mat-form-field>
          </td>
          <td>
            <mat-form-field class="fwhid" [ngStyle]="{ 'padding-bottom.px': !isValidField('Recipient') ? 0 : 40 }">
              <mat-label>Destinatario</mat-label>
              <mat-select formControlName="Recipient" placeholder="Selecciona un destinatario">
                <mat-option *ngFor="let destinatario of customers" [value]="destinatario.DocRut">
                  {{ destinatario.CustomerName }} {{ destinatario.CLastName }}
                </mat-option>
              </mat-select>
              <mat-error *ngIf="isValidField('Recipient')">
                {{ getErrorMessage('Recipient') }}
              </mat-error>
            </mat-form-field>
            </td>
          </tr></table>
          <table><tr>
            <td>
              <mat-form-field class="fwhid"
              [ngStyle]="{ 'padding-bottom.px': !isValidField('RecipientCel') ? 0 : 40 }">
                <input matInput formControlName="RecipientCel" placeholder="Celular" type="text">
                <mat-error *ngIf="isValidField('RecipientCel')">
                  {{getErrorMessage('RecipientCel')}}
                </mat-error>
              </mat-form-field>
            </td>
          </tr></table>
          <fieldset class="zone-container">
            <legend class="lgn">Zona del envio</legend>
          <table><tr>
            <td>
              <mat-form-field class="fwhid">
                <mat-label>Departamento</mat-label>
                <mat-select #stateselect
                            (valueChange)="loadCities($event)"
                            [disabled]="!departamentoSelectEnabled">
                    <mat-option *ngFor="let item of statesValueList; let i = index" [value]="item" >
                      {{ statesLabelList[i] }}
                    </mat-option>
                </mat-select>
              </mat-form-field>
            </td>
            <td>
              <mat-form-field class="fwhid">
                <mat-label>Ciudad</mat-label>
                <mat-select #cities
                            (valueChange)="loadZones($event)"
                            [disabled]="!ciudadSelectEnabled">
                    <mat-option *ngFor="let item of citiesValueList; let i = index" [value]="item">
                    {{ citiesLabelList[i] }}
                  </mat-option>
                </mat-select>
              </mat-form-field>
            </td>
            <td>
              <mat-form-field>
                <mat-label>Zona</mat-label>
                <mat-select #zone
                            formControlName="TargetZone"
                            (valueChange)="onSelectChange($event, 1)">
                  <mat-option *ngFor="let item of CityZones; let i = index" [value]="item.IdZone">
                    {{ item.ZoneName }}
                  </mat-option>
                </mat-select>
              </mat-form-field>
            </td>
          </tr></table>
        </fieldset>
        <!-- Mapa -->
        <ng-container *ngIf="shipmentZoneMapEnabled" >
          <google-map   class="map-s"
                        #map
                        [center]="shipmentZoneCenter"
                        [zoom]="shipmentZoneZoom">

          <map-marker [position]="shipmentZoneMarkerPosition"></map-marker>

          <map-polygon [paths]="shipmentZonePolygonPoints"
                       [options]="shipmentZonePolygonOptions"
                       (polygonClick)="addMarker($event, 1)"
                       ></map-polygon>
          </google-map>
        </ng-container>
          <!-- Direccion -->
          <mat-form-field
              class="fwhid"
              [ngStyle]="{ 'padding-bottom.px': !isValidField('PickupAddressShippingZone') ? 0 : 40 }">
            <input
                type="text"
                matInput
                placeholder="Dirección"
                formControlName="PickupAddressShippingZone">
            <mat-error *ngIf="isValidField('PickupAddressShippingZone')">
              {{getErrorMessage('PickupAddress')}}
            </mat-error>
          </mat-form-field>
          </form>

          <form class="orderForm" *ngIf="this.type === 'envioVentanilla'" [formGroup]="getFormGroup()" >
            <!-- Campos para Envío por Ventanilla -->
          </form>

          <div>
            <button mat-button matStepperPrevious (click)="resetForm()">Atras</button>
            <button mat-button [disabled]="!myForm.get('retiroDomicilio')?.valid" (click)="saveHomePickup()">Siguiente</button>
          </div>
        </div>
      </mat-step>
      <!-- Step 3 - Agregar paquetes -->
      <mat-step>
        <ng-template matStepLabel>Paso  3</ng-template>
        <app-shippment-stages [shippmentId]="shippmentId" (packagesSelected)="handleSelectedPackages($event)"></app-shippment-stages>
        <div>
          <button mat-button matStepperPrevious>Atras</button>
          <button mat-button (click)="newShipmentRegister()">Siguiente</button>
        </div>
      </mat-step>
      <!-- Step 4 - Datos de Envío -->
      <mat-step>
        <ng-template matStepLabel>Paso  4</ng-template>
        <div class="success-message">
          <div style="border-radius:200px; height:200px; width:200px; background: #F8FAF5; margin:0 auto;">
            <i class="checkmark">✓</i>
          </div>
            <h1 class="success-message_title">Envio Generado</h1> 
            <p class="success-message_text">Puedes seguirlo con tu numero de envio<br/><strong>N°: {{shippmentId}}</strong></p>
        </div>
        <div>
          <button mat-button matStepperPrevious>Atras</button>
          <button mat-button (click)="stepper.reset()">Reset</button>
        </div>
      </mat-step>
    </mat-horizontal-stepper>
</div>
